package com.skillstorm.hotelreservationsystem.models;

import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.index.Indexed;
import org.springframework.data.mongodb.core.mapping.Document;

/**
 * Represents a registered user (guest) in the hotel reservation system.
 * <p>
 * This class maps to the "users" collection in MongoDB. It stores personal information,
 * OAuth2 authentication details (Google), and payment identifiers (Stripe).
 * </p>
 * * @author SkillStorm
 * @version 1.0
 */
@Document(collection = "users")
public class User {

    /**
     * The unique identifier for the user.
     * Automatically generated by MongoDB.
     */
    @Id
    private String id;

    /**
     * The user's email address.
     * <p>
     * This is the primary key for looking up users during the OAuth login process.
     * It is indexed and must be unique.
     * </p>
     */
    @Indexed(unique = true)
    private String email;

    /**
     * The user's first name.
     */
    private String firstName;

    /**
     * The user's last name.
     */
    private String lastName;

    /**
     * Container for OAuth-specific authentication details.
     */
    private AuthProvider auth;

    /**
     * The unique customer ID assigned by Stripe.
     * Used for processing payments and saving cards.
     */
    private String stripeCustomerId;

    /**
     * The user's role within the application (e.g., "ROLE_USER").
     */
    private String role;

    // --- Constructors ---

    /**
     * Default constructor for the User class.
     */
    public User() {
    }

    /**
     * Constructs a new User with specific details.
     *
     * @param email     The user's email address.
     * @param firstName The user's first name.
     * @param lastName  The user's last name.
     * @param auth      The OAuth provider details.
     * @param role      The user's role.
     */
    public User(String email, String firstName, String lastName, AuthProvider auth, String role) {
        this.email = email;
        this.firstName = firstName;
        this.lastName = lastName;
        this.auth = auth;
        this.role = role;
    }

    // --- Inner Class for Auth Provider ---

    /**
     * Nested class to store OAuth provider details.
     * Matches the "auth" field in the MongoDB document.
     */
    public static class AuthProvider {
        
        /**
         * The name of the OAuth provider (e.g., "GOOGLE").
         */
        private String provider;

        /**
         * The unique user ID returned by the provider (the "sub" claim).
         */
        private String providerId;

        /**
         * The URL to the user's profile picture.
         */
        private String avatarUrl;

        /**
         * Default constructor for AuthProvider.
         */
        public AuthProvider() {
        }

        /**
         * Constructs a new AuthProvider with specific details.
         *
         * @param provider   The name of the provider.
         * @param providerId The unique ID from the provider.
         * @param avatarUrl  The URL to the profile picture.
         */
        public AuthProvider(String provider, String providerId, String avatarUrl) {
            this.provider = provider;
            this.providerId = providerId;
            this.avatarUrl = avatarUrl;
        }

        /**
         * Gets the name of the OAuth provider.
         *
         * @return The provider name.
         */
        public String getProvider() {
            return provider;
        }

        /**
         * Sets the name of the OAuth provider.
         *
         * @param provider The new provider name.
         */
        public void setProvider(String provider) {
            this.provider = provider;
        }

        /**
         * Gets the unique provider ID.
         *
         * @return The provider ID.
         */
        public String getProviderId() {
            return providerId;
        }

        /**
         * Sets the unique provider ID.
         *
         * @param providerId The new provider ID.
         */
        public void setProviderId(String providerId) {
            this.providerId = providerId;
        }

        /**
         * Gets the profile picture URL.
         *
         * @return The avatar URL.
         */
        public String getAvatarUrl() {
            return avatarUrl;
        }

        /**
         * Sets the profile picture URL.
         *
         * @param avatarUrl The new avatar URL.
         */
        public void setAvatarUrl(String avatarUrl) {
            this.avatarUrl = avatarUrl;
        }

        /**
         * Returns a string representation of the AuthProvider.
         *
         * @return A string containing the provider name and ID.
         */
        @Override
        public String toString() {
            return "AuthProvider [provider=" + provider + ", providerId=" + providerId + "]";
        }

        /**
         * Generates a hash code for this AuthProvider.
         * Based on the provider name and ID.
         *
         * @return The hash code.
         */
        @Override
        public int hashCode() {
            final int prime = 31;
            int result = 1;
            result = prime * result + ((provider == null) ? 0 : provider.hashCode());
            result = prime * result + ((providerId == null) ? 0 : providerId.hashCode());
            result = prime * result + ((avatarUrl == null) ? 0 : avatarUrl.hashCode());
            return result;
        }

        /**
         * Checks if this AuthProvider is equal to another object.
         * Equality is determined by comparing provider details.
         *
         * @param obj The object to compare with.
         * @return True if the objects are equal; false otherwise.
         */
        @Override
        public boolean equals(Object obj) {
            if (this == obj)
                return true;
            if (obj == null)
                return false;
            if (getClass() != obj.getClass())
                return false;
            AuthProvider other = (AuthProvider) obj;
            if (provider == null) {
                if (other.provider != null)
                    return false;
            } else if (!provider.equals(other.provider))
                return false;
            if (providerId == null) {
                if (other.providerId != null)
                    return false;
            } else if (!providerId.equals(other.providerId))
                return false;
            if (avatarUrl == null) {
                if (other.avatarUrl != null)
                    return false;
            } else if (!avatarUrl.equals(other.avatarUrl))
                return false;
            return true;
        }
    }

    // --- Getters and Setters ---

    /**
     * Gets the unique identifier of the user.
     *
     * @return The MongoDB ObjectId as a String.
     */
    public String getId() {
        return id;
    }

    /**
     * Sets the unique identifier of the user.
     *
     * @param id The new MongoDB ObjectId.
     */
    public void setId(String id) {
        this.id = id;
    }

    /**
     * Gets the user's email address.
     *
     * @return The email address.
     */
    public String getEmail() {
        return email;
    }

    /**
     * Sets the user's email address.
     *
     * @param email The new email address.
     */
    public void setEmail(String email) {
        this.email = email;
    }

    /**
     * Gets the user's first name.
     *
     * @return The first name.
     */
    public String getFirstName() {
        return firstName;
    }

    /**
     * Sets the user's first name.
     *
     * @param firstName The new first name.
     */
    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    /**
     * Gets the user's last name.
     *
     * @return The last name.
     */
    public String getLastName() {
        return lastName;
    }

    /**
     * Sets the user's last name.
     *
     * @param lastName The new last name.
     */
    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    /**
     * Gets the OAuth provider details.
     *
     * @return The AuthProvider object.
     */
    public AuthProvider getAuth() {
        return auth;
    }

    /**
     * Sets the OAuth provider details.
     *
     * @param auth The new AuthProvider object.
     */
    public void setAuth(AuthProvider auth) {
        this.auth = auth;
    }

    /**
     * Gets the Stripe customer ID.
     *
     * @return The Stripe customer ID.
     */
    public String getStripeCustomerId() {
        return stripeCustomerId;
    }

    /**
     * Sets the Stripe customer ID.
     *
     * @param stripeCustomerId The new Stripe customer ID.
     */
    public void setStripeCustomerId(String stripeCustomerId) {
        this.stripeCustomerId = stripeCustomerId;
    }

    /**
     * Gets the user's role.
     *
     * @return The role string (e.g., "ROLE_USER").
     */
    public String getRole() {
        return role;
    }

    /**
     * Sets the user's role.
     *
     * @param role The new role string.
     */
    public void setRole(String role) {
        this.role = role;
    }

    /**
     * Returns a string representation of the User.
     *
     * @return A string containing user details.
     */
    @Override
    public String toString() {
        return "User [id=" + id + ", email=" + email + ", firstName=" + firstName + ", lastName=" + lastName + "]";
    }

    /**
     * Generates a hash code for this User.
     * Based on all fields including ID, email, name, auth details, stripe ID, and role.
     *
     * @return The hash code.
     */
    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((id == null) ? 0 : id.hashCode());
        result = prime * result + ((email == null) ? 0 : email.hashCode());
        result = prime * result + ((firstName == null) ? 0 : firstName.hashCode());
        result = prime * result + ((lastName == null) ? 0 : lastName.hashCode());
        result = prime * result + ((auth == null) ? 0 : auth.hashCode());
        result = prime * result + ((stripeCustomerId == null) ? 0 : stripeCustomerId.hashCode());
        result = prime * result + ((role == null) ? 0 : role.hashCode());
        return result;
    }

    /**
     * Checks if this User is equal to another object.
     * Equality is determined by comparing all fields of the User.
     *
     * @param obj The object to compare with.
     * @return True if the objects are equal; false otherwise.
     */
    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        User other = (User) obj;
        if (id == null) {
            if (other.id != null)
                return false;
        } else if (!id.equals(other.id))
            return false;
        if (email == null) {
            if (other.email != null)
                return false;
        } else if (!email.equals(other.email))
            return false;
        if (firstName == null) {
            if (other.firstName != null)
                return false;
        } else if (!firstName.equals(other.firstName))
            return false;
        if (lastName == null) {
            if (other.lastName != null)
                return false;
        } else if (!lastName.equals(other.lastName))
            return false;
        if (auth == null) {
            if (other.auth != null)
                return false;
        } else if (!auth.equals(other.auth))
            return false;
        if (stripeCustomerId == null) {
            if (other.stripeCustomerId != null)
                return false;
        } else if (!stripeCustomerId.equals(other.stripeCustomerId))
            return false;
        if (role == null) {
            if (other.role != null)
                return false;
        } else if (!role.equals(other.role))
            return false;
        return true;
    }
}